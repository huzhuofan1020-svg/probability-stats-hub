<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éšæœºäº‹ä»¶ä¸éŸ¦æ©å›¾ | Probability Hub</title>
    <!-- Neo-Pop Design System -->
    <link rel="stylesheet" href="../../css/style.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        :root {
            --primary: var(--color-primary);
            --secondary: var(--color-secondary);
            --accent: var(--color-accent);
            --bg: var(--color-bg);
            --card: #ffffff;
            --text: var(--color-text);
            --border: var(--color-text);
            --shadow: var(--shadow-hard);
        }

        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            min-height: 100vh;
            background: var(--bg);
            color: var(--text);
            padding-bottom: 80px;
        }

        .header {
            text-align: center;
            margin-bottom: 48px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 900;
            color: var(--text);
            margin-bottom: 12px;
            letter-spacing: -1.5px;
            text-transform: uppercase;
        }

        .header h1 span {
            color: var(--primary);
        }

        .card {
            background: var(--card);
            border: var(--border-width) solid var(--color-text);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-hard);
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* å‚æ•°è®¾ç½®å¡ç‰‡ - å…¨å®½ */
        .params-card {
            width: 100%;
        }

        .params-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        @media (max-width: 1200px) {
            .params-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ä¸­é—´åŒºåŸŸï¼šéŸ¦æ©å›¾ + å³ä¾§é¢æ¿ */
        .middle-section {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 24px;
            align-items: start;
        }

        @media (max-width: 900px) {
            .middle-section {
                grid-template-columns: 1fr;
            }
        }

        /* å³ä¾§é¢æ¿ */
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* å‚ç›´æ¨¡å¼æŒ‰é’® - ç®€çº¦é£æ ¼ */
        .mode-buttons-vertical {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .mode-buttons-vertical .mode-btn {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 4px;
            padding: 12px 16px;
            text-align: left;
        }

        .mode-buttons-vertical .mode-text {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .mode-buttons-vertical .mode-formula {
            font-size: 0.7rem;
            font-weight: 500;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .mode-buttons-vertical .mode-btn.active .mode-formula {
            color: inherit;
            opacity: 0.75;
        }

        /* ç‹¬ç«‹æ€§æ£€éªŒå†…å®¹ */
        .check-content {
            text-align: center;
        }

        .check-content .check-row {
            justify-content: center;
            gap: 16px;
            margin-bottom: 8px;
            padding: 10px 16px;
            background: var(--bg);
            border-radius: 10px;
        }

        .check-content .check-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .check-content .check-val {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text);
        }

        .check-divider {
            padding: 6px 0;
        }

        .check-vs {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .check-content .status-badge {
            width: 100%;
            justify-content: center;
        }

        /* å…¬å¼åŒºåŸŸ */
        .formulas-section {
            width: 100%;
        }

        @media (max-width: 1000px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .section-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        /* æ¦‚ç‡æ§åˆ¶å™¨ */
        .prob-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg);
            border-radius: 14px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
            flex-wrap: wrap;
        }

        .prob-item>.prob-circle,
        .prob-item>.prob-content {
            flex-shrink: 0;
        }

        .prob-item>.delta-container {
            flex-basis: 100%;
        }

        .prob-item:hover {
            box-shadow: var(--shadow);
        }

        .prob-circle {
            position: relative;
            width: 64px;
            height: 64px;
            flex-shrink: 0;
        }

        .prob-circle svg {
            transform: rotate(-90deg);
            width: 64px;
            height: 64px;
        }

        .prob-circle .bg-ring {
            fill: none;
            stroke: var(--border);
            stroke-width: 6;
        }

        .prob-circle .progress-ring {
            fill: none;
            stroke-width: 6;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s ease;
        }

        .prob-circle.circle-a .progress-ring {
            stroke: #f97316;
        }

        .prob-circle.circle-b .progress-ring {
            stroke: #3b82f6;
        }

        .prob-circle.circle-ab .progress-ring {
            stroke: #a855f7;
        }

        .prob-circle .value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .circle-a .value {
            color: #f97316;
        }

        .circle-b .value {
            color: #3b82f6;
        }

        .circle-ab .value {
            color: #a855f7;
        }

        .prob-content {
            flex: 1;
            min-width: 0;
        }

        .prob-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .prob-label .tag {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: 800;
            border: 2px solid var(--color-text);
        }

        .tag-a {
            background: var(--color-accent);
            color: var(--color-text);
        }

        .tag-b {
            background: var(--color-primary);
            color: white;
        }

        .tag-ab {
            background: var(--color-secondary);
            color: white;
        }

        .prob-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        /* æ»‘å—ä¸æ•°å€¼è¾“å…¥çš„ç»„åˆ */
        .slider-with-input {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .slider-with-input .prob-slider {
            flex: 1;
        }

        /* æ»‘å—è½´å®¹å™¨ */
        .slider-axis-container {
            position: relative;
            flex: 1;
            padding: 0 9px;
            /* æ»‘å—thumbåŠå¾„ï¼Œç¡®ä¿åˆ»åº¦å’Œæ»‘å—å¯¹é½ */
        }

        .slider-axis-container .prob-slider {
            width: 100%;
            margin: 0 -9px;
            /* æŠµæ¶ˆpaddingï¼Œè®©æ»‘å—å æ»¡å®½åº¦ */
            width: calc(100% + 18px);
        }

        /* åˆ»åº¦è½´ */
        .slider-axis {
            position: relative;
            height: 16px;
            margin-top: 2px;
        }

        .axis-line {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border);
        }

        .axis-ticks {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
        }

        .axis-tick {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .axis-tick::before {
            content: '';
            width: 1px;
            height: 5px;
            background: var(--border);
        }

        .axis-tick.major::before {
            height: 7px;
            background: var(--text-muted);
        }

        .axis-tick-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.55rem;
            color: var(--text-muted);
            margin-top: 1px;
        }

        .axis-tick.major .axis-tick-label {
            font-size: 0.6rem;
            color: var(--text-secondary);
        }

        /* å½“å‰å€¼æŒ‡ç¤ºå™¨ */
        .current-value-indicator {
            position: absolute;
            top: -4px;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 5px solid var(--primary);
            /* ç§»é™¤ left çš„ transition ä»¥è·å¾—æ›´è·Ÿæ‰‹çš„æ»‘åŠ¨ä½“éªŒ */
            transition: border-bottom-color 0.2s ease;
            pointer-events: none;
            will-change: left;
            /* æ€§èƒ½ä¼˜åŒ– */
        }

        .slider-axis-container.axis-a .current-value-indicator {
            border-bottom-color: #f97316;
        }

        .slider-axis-container.axis-b .current-value-indicator {
            border-bottom-color: #3b82f6;
        }

        .slider-axis-container.axis-ab .current-value-indicator {
            border-bottom-color: #a855f7;
        }

        /* å½“å¸é™„åˆ°ç‹¬ç«‹ç‚¹æ—¶ï¼Œå°ä¸‰è§’å˜ç»¿ */
        .slider-axis-container.axis-ab .current-value-indicator.snapped {
            border-bottom-color: #10b981;
        }

        /* ç‹¬ç«‹ç‚¹åç§»é‡æ˜¾ç¤º - æ”¾åœ¨åˆ»åº¦è½´ä¸‹æ–¹å±…ä¸­ */
        .independence-delta {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .independence-delta.show {
            opacity: 1;
        }

        .independence-delta.positive {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.08));
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.25);
        }

        .independence-delta.negative {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(139, 92, 246, 0.08));
            color: #7c3aed;
            border: 1px solid rgba(139, 92, 246, 0.25);
        }

        .independence-delta.zero {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.08));
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.25);
        }

        /* Delta Formula Hint */
        .delta-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-top: 10px;
        }

        .independence-delta {
            position: relative;
            cursor: default;
        }

        .delta-formula-hint {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            color: #94a3b8;
            margin-left: 10px;
            padding-left: 10px;
            border-left: 1px solid #cbd5e1;
            line-height: 1.2;
            font-weight: 400;
            white-space: nowrap;
            opacity: 1;
        }

        /* P(AB) èŒƒå›´æŒ‡ç¤ºå™¨ */
        .pab-range-indicator {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            padding: 4px 8px;
            background: linear-gradient(90deg, rgba(168, 85, 247, 0.08), rgba(236, 72, 153, 0.08));
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
        }

        .pab-range-indicator .range-min,
        .pab-range-indicator .range-max {
            font-weight: 600;
            color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .pab-range-indicator .range-arrow {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .value-input {
            width: 85px;
            padding: 8px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 800;
            color: var(--text);
            text-align: center;
            outline: none;
            box-shadow: 2px 2px 0 var(--border);
        }

        .value-input:hover {
            border-color: var(--text-muted);
        }

        .value-input:focus {
            border-color: var(--primary);
            box-shadow: 3px 3px 0 var(--primary);
        }

        .value-input.input-a:focus {
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        .value-input.input-b:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .value-input.input-ab:focus {
            border-color: #a855f7;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        /* æ•°å€¼è¾“å…¥æ¡†åç¼€ */
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-suffix {
            position: absolute;
            right: 8px;
            font-size: 0.7rem;
            color: var(--text-muted);
            pointer-events: none;
        }

        .value-input.has-suffix {
            padding-right: 24px;
        }

        .prob-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--border);
            outline: none;
            cursor: pointer;
        }

        .prob-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }

        .prob-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
        }

        .slider-a::-webkit-slider-thumb {
            background: #f97316;
        }

        .slider-b::-webkit-slider-thumb {
            background: #3b82f6;
        }

        .slider-ab::-webkit-slider-thumb {
            background: #a855f7;
        }

        .prob-slider:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* æ»‘å—å®¹å™¨å’Œç‹¬ç«‹æ€§æ ‡è®° */
        .slider-container {
            position: relative;
            padding-top: 8px;
        }

        /* ç‹¬ç«‹æ€§æ ‡è®° - éšè—ï¼Œæ”¹ç”¨å°ä¸‰è§’é¢œè‰²å˜åŒ–æ¥è¡¨ç¤º */
        .independence-marker {
            display: none;
        }



        /* å…¬å¼æ˜¾ç¤ºï¼ˆéè‡ªç”±æ¨¡å¼ï¼‰ */
        .formula-display {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.08), rgba(236, 72, 153, 0.08));
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 10px;
            padding: 12px 16px;
            text-align: center;
        }

        .formula-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--primary);
            font-weight: 500;
        }

        /* P(AB) é¡¹åœ¨ä¸åŒæ¨¡å¼ä¸‹çš„æ ·å¼ */
        .prob-item.locked {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(16, 185, 129, 0.02));
            border: 1px solid rgba(16, 185, 129, 0.15);
        }

        .prob-item.locked-disjoint {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(239, 68, 68, 0.02));
            border: 1px solid rgba(239, 68, 68, 0.15);
        }

        /* æ¨¡å¼é€‰æ‹© */
        .mode-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .mode-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .mode-btn {
            padding: 12px 8px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--card);
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mode-btn:hover {
            border-color: var(--text-muted);
            background: var(--bg);
        }

        .mode-btn.active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.08);
            color: var(--primary);
        }

        .mode-btn.active.mode-independent {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.08);
            color: var(--success);
        }

        .mode-btn.active.mode-disjoint {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.08);
            color: var(--danger);
        }

        /* ç‹¬ç«‹æ€§æ£€éªŒ */
        .independence-check {
            margin-top: 20px;
            padding: 16px;
            background: var(--bg);
            border-radius: 14px;
        }

        .check-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .check-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .check-row .val {
            font-weight: 600;
            color: var(--text);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 100px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 12px;
        }

        .status-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .status-badge.independent {
            background: rgba(16, 185, 129, 0.12);
            color: #059669;
        }

        .status-badge.positive {
            background: rgba(245, 158, 11, 0.12);
            color: #d97706;
        }

        .status-badge.negative {
            background: rgba(139, 92, 246, 0.12);
            color: #7c3aed;
        }

        .status-badge.disjoint {
            background: rgba(239, 68, 68, 0.12);
            color: #dc2626;
        }

        /* å¯è§†åŒ–åŒºåŸŸ */
        .viz-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .canvas-card {
            position: relative;
            overflow: hidden;
        }

        /* éŸ¦æ©å›¾æ¿å—å†…éƒ¨å¸ƒå±€ */
        .venn-layout {
            display: flex;
            gap: 24px;
            align-items: flex-start;
        }

        .venn-left {
            flex: 1;
            min-width: 0;
        }

        .venn-right {
            width: 240px;
            flex-shrink: 0;
            background: var(--bg);
            border-radius: 16px;
            padding: 20px;
        }

        .panel-section {
            margin-bottom: 0;
        }

        .panel-section .section-label {
            margin-bottom: 12px;
        }

        .panel-divider {
            height: 1px;
            background: var(--border);
            margin: 16px 0;
        }

        /* å³ä¾§é¢æ¿çš„æ¨¡å¼æŒ‰é’® */
        .venn-right .mode-buttons-vertical {
            gap: 8px;
        }

        .venn-right .mode-btn {
            padding: 10px 12px;
            gap: 10px;
        }

        .venn-right .mode-icon {
            font-size: 1.1rem;
        }

        .venn-right .mode-info {
            flex: 1;
        }

        .venn-right .mode-text {
            font-size: 0.85rem;
        }

        .venn-right .mode-desc {
            font-size: 0.65rem;
        }

        /* ç®€çº¦å¤§æ°”çš„æ¨¡å¼æŒ‰é’® */
        .mode-buttons-simple {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mode-btn-simple {
            padding: 14px 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--card);
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            letter-spacing: 0.5px;
        }

        .mode-btn-simple:hover {
            border-color: var(--primary-light);
            background: rgba(99, 102, 241, 0.04);
            color: var(--text);
        }

        .mode-btn-simple.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(99, 102, 241, 0.05));
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);
        }

        .mode-btn-simple.active.mode-independent {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            color: var(--success);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
        }

        .mode-btn-simple.active.mode-disjoint {
            border-color: var(--danger);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            color: var(--danger);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.15);
        }

        /* å³ä¾§é¢æ¿çš„ç‹¬ç«‹æ€§æ£€éªŒ */
        .check-comparison {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .check-item {
            text-align: center;
            padding: 8px 12px;
            background: var(--card);
            border-radius: 10px;
            flex: 1;
        }

        .check-item .check-label {
            display: block;
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        .check-item .check-val {
            display: block;
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
        }

        .check-comparison .check-vs {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            padding: 4px 6px;
        }

        .venn-right .status-badge {
            width: 100%;
            justify-content: center;
            margin-top: 8px;
            padding: 6px 12px;
            font-size: 0.75rem;
        }

        @media (max-width: 900px) {
            .venn-layout {
                flex-direction: column;
            }

            .venn-right {
                width: 100%;
            }
        }

        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 12px;
        }

        .canvas-legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 4px;
        }

        .legend-dot.a {
            background: rgba(249, 115, 22, 0.7);
        }

        .legend-dot.b {
            background: rgba(59, 130, 246, 0.7);
        }

        .legend-dot.ab {
            background: rgba(168, 85, 247, 0.8);
        }

        /* å…¬å¼å¡ç‰‡ */
        .formula-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        @media (max-width: 800px) {
            .formula-grid {
                grid-template-columns: 1fr;
            }
        }

        .formula-card {
            background: #ffffff;
            border: var(--border-width) solid var(--color-text);
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: 4px 4px 0px var(--color-text);
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: transform 0.2s;
        }

        .formula-card:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0px var(--color-text);
        }

        .formula-card h4 {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .formula-card .formula {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text);
            padding: 8px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .formula-card .result {
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
            align-self: flex-end;
        }

        /* åº•éƒ¨æç¤º */
        .hint-bar {
            text-align: center;
            margin-top: 32px;
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .hint-bar span {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 100px;
        }

        /* äº’æ–¥å†²çªæç¤º */
        .conflict-hint {
            position: absolute;
            top: -28px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.12), rgba(239, 68, 68, 0.06));
            color: #dc2626;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            border: 1px solid rgba(239, 68, 68, 0.2);
            z-index: 10;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.1);
        }

        .conflict-hint.show {
            opacity: 1;
        }

        /* é”®ç›˜å¾®è°ƒæç¤º */
        .keyboard-hint {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .keyboard-hint kbd {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 18px;
            padding: 0 4px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--text-secondary);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        /* æ»‘å—è·å¾—ç„¦ç‚¹æ—¶çš„æç¤º */
        .slider-focus-hint {
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .prob-slider:focus+.slider-axis+.slider-focus-hint,
        .prob-slider:focus~.slider-focus-hint {
            opacity: 1;
        }

        /* è£…é¥°å…ƒç´  */
        .decoration {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
        }

        .decoration-1 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.06) 0%, transparent 70%);
            top: -100px;
            left: -100px;
        }

        .decoration-2 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(236, 72, 153, 0.06) 0%, transparent 70%);
            bottom: -50px;
            right: -50px;
        }
    </style>
</head>

<body>

    <!-- è£…é¥°èƒŒæ™¯ -->
    <div class="decoration decoration-1"></div>
    <div class="decoration decoration-2"></div>

    <!-- SVGæ¸å˜å®šä¹‰ -->
    <svg width="0" height="0">
        <defs>
            <linearGradient id="gradientA" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#f97316" />
                <stop offset="100%" stop-color="#ef4444" />
            </linearGradient>
            <linearGradient id="gradientB" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#3b82f6" />
                <stop offset="100%" stop-color="#06b6d4" />
            </linearGradient>
            <linearGradient id="gradientAB" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#a855f7" />
                <stop offset="100%" stop-color="#ec4899" />
            </linearGradient>
        </defs>
    </svg>

    <div class="container" style="margin-top: var(--space-md); margin-bottom: 40px;">
        <nav class="navbar">
            <a href="../../chapter1.html" class="logo">
                <div class="logo-icon"><i class="ph-bold ph-arrow-left"></i></div>
                <span>Back to Chapter 1</span>
            </a>
            <div class="nav-menu">
                <span style="font-weight: 800; font-size: 1.1rem;">éšæœºäº‹ä»¶ä¸éŸ¦æ©å›¾äº’åŠ¨å®éªŒ</span>
            </div>
            <div class="badge" style="margin-bottom: 0; background: var(--color-accent);">æ¨¡å‹æ¼”ç¤º</div>
        </nav>
    </div>

    <div class="header">
        <div class="header-badge">æ¦‚ç‡è®º Â· äº’åŠ¨æ•™å­¦</div>
        <h1>éšæœºäº‹ä»¶ä¸<span>éŸ¦æ©å›¾</span></h1>
        <p>é€šè¿‡å¯è§†åŒ–äº¤äº’ï¼Œæ¢ç´¢äº‹ä»¶å…³ç³»ã€ç‹¬ç«‹æ€§ä¸æ¡ä»¶æ¦‚ç‡</p>
    </div>

    <div class="main-container">
        <!-- æ¦‚ç‡å‚æ•°è®¾ç½® - é¡¶éƒ¨ -->
        <div class="card params-card">
            <div class="section-label">æ¦‚ç‡å‚æ•°è®¾ç½®</div>
            <div class="params-grid">
                <!-- P(A) -->
                <div class="prob-item">
                    <div class="prob-circle circle-a">
                        <svg viewBox="0 0 64 64">
                            <circle class="bg-ring" cx="32" cy="32" r="26" />
                            <circle class="progress-ring" cx="32" cy="32" r="26" stroke-dasharray="163.36"
                                stroke-dashoffset="81.68" id="progress-a" />
                        </svg>
                        <div class="value" id="val-pa">0.50</div>
                    </div>
                    <div class="prob-content">
                        <div class="prob-label">
                            äº‹ä»¶ A çš„æ¦‚ç‡
                            <span class="tag tag-a">P(A)</span>
                        </div>
                        <div class="prob-desc">äº‹ä»¶ A å‘ç”Ÿçš„å¯èƒ½æ€§</div>
                        <div class="slider-with-input">
                            <div class="slider-axis-container axis-a" id="axis-container-pa">
                                <input type="range" class="prob-slider slider-a" id="range-pa" min="0.0001" max="0.9999"
                                    step="0.0001" value="0.5">
                                <div class="slider-axis">
                                    <div class="axis-line"></div>
                                    <div class="axis-ticks" id="axis-ticks-pa"></div>
                                    <div class="current-value-indicator" id="indicator-pa"></div>
                                </div>
                            </div>
                            <input type="number" class="value-input input-a" id="input-pa" min="0.0001" max="0.9999"
                                step="0.0001" value="0.5000">
                        </div>
                    </div>
                </div>

                <!-- P(B) -->
                <div class="prob-item">
                    <div class="prob-circle circle-b">
                        <svg viewBox="0 0 64 64">
                            <circle class="bg-ring" cx="32" cy="32" r="26" />
                            <circle class="progress-ring" cx="32" cy="32" r="26" stroke-dasharray="163.36"
                                stroke-dashoffset="98" id="progress-b" />
                        </svg>
                        <div class="value" id="val-pb">0.40</div>
                    </div>
                    <div class="prob-content">
                        <div class="prob-label">
                            äº‹ä»¶ B çš„æ¦‚ç‡
                            <span class="tag tag-b">P(B)</span>
                        </div>
                        <div class="prob-desc">äº‹ä»¶ B å‘ç”Ÿçš„å¯èƒ½æ€§</div>
                        <div class="slider-with-input">
                            <div class="slider-axis-container axis-b" id="axis-container-pb">
                                <input type="range" class="prob-slider slider-b" id="range-pb" min="0.0001" max="0.9999"
                                    step="0.0001" value="0.4">
                                <div class="slider-axis">
                                    <div class="axis-line"></div>
                                    <div class="axis-ticks" id="axis-ticks-pb"></div>
                                    <div class="current-value-indicator" id="indicator-pb"></div>
                                </div>
                            </div>
                            <input type="number" class="value-input input-b" id="input-pb" min="0.0001" max="0.9999"
                                step="0.0001" value="0.4000">
                        </div>
                    </div>
                </div>

                <!-- P(AB) -->
                <div class="prob-item" id="pab-item">
                    <div class="prob-circle circle-ab">
                        <svg viewBox="0 0 64 64">
                            <circle class="bg-ring" cx="32" cy="32" r="26" />
                            <circle class="progress-ring" cx="32" cy="32" r="26" stroke-dasharray="163.36"
                                stroke-dashoffset="130.69" id="progress-ab" />
                        </svg>
                        <div class="value" id="val-pab">0.20</div>
                    </div>
                    <div class="prob-content">
                        <div class="prob-label">
                            äº¤äº‹ä»¶æ¦‚ç‡
                            <span class="tag tag-ab">P(Aâˆ©B)</span>
                        </div>
                        <div class="prob-desc" id="pab-desc">A å’Œ B åŒæ—¶å‘ç”Ÿçš„æ¦‚ç‡</div>
                        <!-- è‡ªç”±æ¨¡å¼ä¸‹çš„æ»‘å— -->
                        <div class="slider-container" id="pab-slider-container">
                            <div class="slider-with-input">
                                <div class="slider-axis-container axis-ab" id="axis-container-pab">
                                    <input type="range" class="prob-slider slider-ab" id="range-pab" min="0" max="0.4"
                                        step="0.0001" value="0.2">
                                    <div class="slider-axis">
                                        <div class="axis-line"></div>
                                        <div class="axis-ticks" id="axis-ticks-pab"></div>
                                        <div class="current-value-indicator" id="indicator-pab"></div>
                                    </div>
                                </div>
                                <input type="number" class="value-input input-ab" id="input-pab" min="0" max="0.4"
                                    step="0.0001" value="0.2000">
                            </div>
                        </div>
                        <!-- éè‡ªç”±æ¨¡å¼ä¸‹çš„è®¡ç®—å…¬å¼æ˜¾ç¤º -->
                        <div class="formula-display" id="pab-formula" style="display: none;">
                            <span class="formula-text" id="formula-text">P(A) Ã— P(B) = 0.20</span>
                        </div>
                    </div>
                    <div class="delta-container">
                        <div class="independence-delta" id="independence-delta">Î” = 0</div>
                        <div class="delta-formula-hint">Î” = P(AB) - P(A)P(B)</div>
                    </div>
                </div>

            </div>
        </div>

        <!-- éŸ¦æ©å›¾æ¿å—ï¼ˆåŒ…å«éŸ¦æ©å›¾ + å¿«æ·æ¨¡å¼ + ç‹¬ç«‹æ€§æ£€éªŒï¼‰ -->
        <div class="card canvas-card">
            <div class="venn-layout">
                <!-- å·¦ä¾§ï¼šéŸ¦æ©å›¾ -->
                <div class="venn-left">
                    <canvas id="vennCanvas" width="480" height="380"></canvas>
                    <div class="canvas-legend">
                        <div class="legend-item">
                            <span class="legend-dot a"></span>
                            <span>äº‹ä»¶ A</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot b"></span>
                            <span>äº‹ä»¶ B</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot ab"></span>
                            <span>A âˆ© B</span>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šå¿«æ·æ¨¡å¼ + ç‹¬ç«‹æ€§æ£€éªŒ -->
                <div class="venn-right">
                    <!-- å¿«æ·æ¨¡å¼ -->
                    <div class="panel-section">
                        <div class="section-label">å¿«æ·æ¨¡å¼</div>
                        <div class="mode-buttons-simple">
                            <button class="mode-btn-simple active" id="btn-free">è‡ªç”±è°ƒèŠ‚</button>
                            <button class="mode-btn-simple" id="btn-independent">ç›¸äº’ç‹¬ç«‹</button>
                            <button class="mode-btn-simple" id="btn-disjoint">äº’ä¸ç›¸å®¹</button>
                        </div>
                    </div>

                    <!-- åˆ†éš”çº¿ -->
                    <div class="panel-divider"></div>

                    <!-- ç‹¬ç«‹æ€§æ£€éªŒ -->
                    <div class="panel-section">
                        <div class="section-label">ç‹¬ç«‹æ€§æ£€éªŒ</div>
                        <div class="check-content">
                            <div class="check-comparison">
                                <div class="check-item">
                                    <span class="check-label">P(Aâˆ©B)</span>
                                    <span class="check-val" id="disp-pab">0.2000</span>
                                </div>
                                <div class="check-vs">vs</div>
                                <div class="check-item">
                                    <span class="check-label">P(A)Ã—P(B)</span>
                                    <span class="check-val" id="disp-papb">0.2000</span>
                                </div>
                            </div>
                            <div class="status-badge independent" id="relation-status">
                                ç›¸äº’ç‹¬ç«‹
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å…¬å¼å¡ç‰‡åŒºåŸŸ -->
        <div class="formulas-section">
            <div class="formula-grid">
                <div class="formula-card">
                    <h4>å¹¶äº‹ä»¶</h4>
                    <div class="formula">P(AâˆªB) = P(A) + P(B) - P(Aâˆ©B)</div>
                    <div class="result" id="calc-union">0.70</div>
                </div>
                <div class="formula-card">
                    <h4>å·®äº‹ä»¶</h4>
                    <div class="formula">P(A - B) = P(A) - P(Aâˆ©B)</div>
                    <div class="result" id="calc-diff">0.30</div>
                </div>
                <div class="formula-card">
                    <h4>æ¡ä»¶æ¦‚ç‡</h4>
                    <div class="formula">P(B|A) = P(Aâˆ©B) / P(A)</div>
                    <div class="result" id="calc-cond">0.40</div>
                </div>
            </div>
        </div>
    </div>

    <div class="hint-bar">
        <span>ğŸ’¡ æ‹–åŠ¨æ»‘å—è°ƒæ•´æ¦‚ç‡å‚æ•° Â· ç‚¹å‡»æ»‘å—åå¯ç”¨ <kbd>â†</kbd> <kbd>â†’</kbd> é”®å¾®è°ƒï¼ˆæ­¥è¿› 0.0001ï¼‰</span>
    </div>

    <script>
        // DOM å…ƒç´ 
        const elements = {
            rangePA: document.getElementById('range-pa'),
            rangePB: document.getElementById('range-pb'),
            rangePAB: document.getElementById('range-pab'),
            inputPA: document.getElementById('input-pa'),
            inputPB: document.getElementById('input-pb'),
            inputPAB: document.getElementById('input-pab'),
            valPA: document.getElementById('val-pa'),
            valPB: document.getElementById('val-pb'),
            valPAB: document.getElementById('val-pab'),
            progressA: document.getElementById('progress-a'),
            progressB: document.getElementById('progress-b'),
            progressAB: document.getElementById('progress-ab'),
            dispPAB: document.getElementById('disp-pab'),
            dispPAPB: document.getElementById('disp-papb'),
            relationStatus: document.getElementById('relation-status'),
            calcUnion: document.getElementById('calc-union'),
            calcDiff: document.getElementById('calc-diff'),
            calcCond: document.getElementById('calc-cond'),
            btnFree: document.getElementById('btn-free'),
            btnIndependent: document.getElementById('btn-independent'),
            btnDisjoint: document.getElementById('btn-disjoint'),
            pabItem: document.getElementById('pab-item'),
            pabDesc: document.getElementById('pab-desc'),
            pabSliderContainer: document.getElementById('pab-slider-container'),
            pabFormula: document.getElementById('pab-formula'),
            formulaText: document.getElementById('formula-text'),
            independenceMarker: document.getElementById('independence-marker')
        };

        const canvas = document.getElementById('vennCanvas');
        const ctx = canvas.getContext('2d');

        // çŠ¶æ€
        let state = {
            pa: 0.5,
            pb: 0.4,
            pab: 0.2,
            mode: 'free',
            isSnapped: false  // æ˜¯å¦å¸é™„åˆ°ç‹¬ç«‹ç‚¹
        };

        // å¸é™„é˜ˆå€¼ï¼ˆå½“æ»‘å—å€¼ä¸ç‹¬ç«‹ç‚¹ç›¸å·®åœ¨æ­¤èŒƒå›´å†…æ—¶è‡ªåŠ¨å¸é™„ï¼‰
        const SNAP_THRESHOLD = 0.001;

        // åœ†ç¯å‘¨é•¿
        const circumference = 2 * Math.PI * 26;

        // åˆ»åº¦è½´å…ƒç´ 
        const axisElements = {
            ticksPA: document.getElementById('axis-ticks-pa'),
            ticksPB: document.getElementById('axis-ticks-pb'),
            ticksPAB: document.getElementById('axis-ticks-pab'),
            indicatorPA: document.getElementById('indicator-pa'),
            indicatorPB: document.getElementById('indicator-pb'),
            indicatorPAB: document.getElementById('indicator-pab')
        };

        // ç”Ÿæˆåˆ»åº¦è½´
        function generateAxisTicks(container, min, max, step = 0.1) {
            container.innerHTML = '';
            const range = max - min;
            const numTicks = Math.round(range / step) + 1;

            for (let i = 0; i < numTicks; i++) {
                const value = min + i * step;
                const tick = document.createElement('div');
                tick.className = 'axis-tick';

                // 0, 0.5, 1 ä¸ºä¸»åˆ»åº¦
                if (Math.abs(value % 0.5) < 0.001 || Math.abs(value) < 0.001 || Math.abs(value - 1) < 0.001) {
                    tick.classList.add('major');
                }

                const label = document.createElement('span');
                label.className = 'axis-tick-label';
                // åªæ˜¾ç¤ºä¸»åˆ»åº¦çš„æ ‡ç­¾
                if (tick.classList.contains('major')) {
                    label.textContent = value.toFixed(1);
                }
                tick.appendChild(label);
                container.appendChild(tick);
            }
        }

        // æ›´æ–°æŒ‡ç¤ºå™¨ä½ç½® - ä½¿ç”¨ç™¾åˆ†æ¯”å®šä½ï¼Œä¸åˆ»åº¦è½´å¯¹é½
        function updateValueIndicator(slider, indicator, value) {
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            const percent = (value - min) / (max - min) * 100;
            indicator.style.left = `${percent}%`;
        }

        // åˆå§‹åŒ–åˆ»åº¦è½´
        function initAxis() {
            generateAxisTicks(axisElements.ticksPA, 0, 1, 0.1);
            generateAxisTicks(axisElements.ticksPB, 0, 1, 0.1);
            updatePABAxis();
        }

        // æ›´æ–° P(AB) åˆ»åº¦è½´ï¼ˆèŒƒå›´åŠ¨æ€å˜åŒ–ï¼‰
        function updatePABAxis() {
            const min = parseFloat(elements.rangePAB.min);
            const max = parseFloat(elements.rangePAB.max);
            const range = max - min;

            axisElements.ticksPAB.innerHTML = '';

            // å›ºå®šæ˜¾ç¤º 5 ä¸ªåˆ»åº¦ç‚¹ï¼Œå…¨éƒ¨æ˜¾ç¤ºæ•°å€¼
            const numTicks = 5;

            for (let i = 0; i < numTicks; i++) {
                const value = min + (range * i / (numTicks - 1));
                const tick = document.createElement('div');
                tick.className = 'axis-tick major'; // å…¨éƒ¨ä½œä¸ºä¸»åˆ»åº¦æ˜¾ç¤ºæ•°å€¼

                const label = document.createElement('span');
                label.className = 'axis-tick-label';
                label.textContent = value.toFixed(4);
                tick.appendChild(label);
                axisElements.ticksPAB.appendChild(tick);
            }

            // æ›´æ–°èŒƒå›´æŒ‡ç¤ºå™¨
            updateRangeIndicator(min, max);
        }

        // æ·»åŠ èŒƒå›´å˜åŒ–æŒ‡ç¤ºå™¨
        function updateRangeIndicator(min, max) {
            let indicator = document.getElementById('pab-range-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'pab-range-indicator';
                indicator.className = 'pab-range-indicator';
                const container = document.getElementById('axis-container-pab');
                container.insertBefore(indicator, container.firstChild);
            }
            indicator.innerHTML = `<span class="range-min">${min.toFixed(4)}</span><span class="range-arrow">â†”</span><span class="range-max">${max.toFixed(4)}</span>`;
        }

        // åˆå§‹åŒ–
        function init() {
            initAxis();
            updateModeButtons();
            updatePABUI();
            addEventListeners();
            update();
        }

        function addEventListeners() {
            // P(A) æ»‘å—
            elements.rangePA.addEventListener('input', e => {
                state.pa = parseFloat(e.target.value);
                state.isSnapped = false; // è°ƒæ•´ P(A) æ—¶å¼ºåˆ¶è§£é™¤å¸é™„
                if (state.mode !== 'free') {
                    applyModeConstraints();
                }
                update();
            });

            // P(A) æ•°å€¼è¾“å…¥
            elements.inputPA.addEventListener('input', e => {
                let val = parseFloat(e.target.value);
                if (!isNaN(val)) {
                    val = Math.max(0.01, Math.min(0.99, val));
                    state.pa = val;
                    state.isSnapped = false; // è°ƒæ•´ P(A) æ—¶å¼ºåˆ¶è§£é™¤å¸é™„
                    if (state.mode !== 'free') {
                        applyModeConstraints();
                    }
                    update();
                }
            });

            elements.inputPA.addEventListener('blur', e => {
                e.target.value = state.pa.toFixed(4);
            });

            // P(B) æ»‘å—
            elements.rangePB.addEventListener('input', e => {
                state.pb = parseFloat(e.target.value);
                state.isSnapped = false; // è°ƒæ•´ P(B) æ—¶å¼ºåˆ¶è§£é™¤å¸é™„
                if (state.mode !== 'free') {
                    applyModeConstraints();
                }
                update();
            });

            // P(B) æ•°å€¼è¾“å…¥
            elements.inputPB.addEventListener('input', e => {
                let val = parseFloat(e.target.value);
                if (!isNaN(val)) {
                    val = Math.max(0.01, Math.min(0.99, val));
                    state.pb = val;
                    state.isSnapped = false; // è°ƒæ•´ P(B) æ—¶å¼ºåˆ¶è§£é™¤å¸é™„
                    if (state.mode !== 'free') {
                        applyModeConstraints();
                    }
                    update();
                }
            });

            elements.inputPB.addEventListener('blur', e => {
                e.target.value = state.pb.toFixed(4);
            });

            // P(AB) æ»‘å—
            elements.rangePAB.addEventListener('input', e => {
                let newPab = parseFloat(e.target.value);
                const independentValue = state.pa * state.pb;

                // å¸é™„é€»è¾‘ï¼šå½“æ¥è¿‘ç‹¬ç«‹ç‚¹æ—¶è‡ªåŠ¨å¸é™„
                if (Math.abs(newPab - independentValue) < SNAP_THRESHOLD) {
                    state.pab = independentValue;
                    state.isSnapped = true;
                } else {
                    state.pab = newPab;
                    state.isSnapped = false;
                }

                state.mode = 'free';
                updateModeButtons();
                updatePABUI();
                update();
            });

            // P(AB) æ•°å€¼è¾“å…¥
            elements.inputPAB.addEventListener('input', e => {
                let val = parseFloat(e.target.value);
                if (!isNaN(val)) {
                    const maxPAB = Math.min(state.pa, state.pb);
                    const minPAB = Math.max(0, state.pa + state.pb - 1);
                    val = Math.max(minPAB, Math.min(maxPAB, val));

                    const independentValue = state.pa * state.pb;
                    // å¸é™„é€»è¾‘
                    if (Math.abs(val - independentValue) < SNAP_THRESHOLD) {
                        state.pab = independentValue;
                        state.isSnapped = true;
                    } else {
                        state.pab = val;
                        state.isSnapped = false;
                    }

                    state.mode = 'free';
                    updateModeButtons();
                    updatePABUI();
                    update();
                }
            });

            elements.inputPAB.addEventListener('blur', e => {
                e.target.value = state.pab.toFixed(4);
            });

            elements.btnFree.addEventListener('click', () => {
                state.mode = 'free';
                state.isSnapped = false;
                updateModeButtons();
                updatePABUI();
                update();
            });

            elements.btnIndependent.addEventListener('click', () => {
                state.mode = 'independent';
                applyModeConstraints();
                updateModeButtons();
                updatePABUI();
                update();
            });

            elements.btnDisjoint.addEventListener('click', () => {
                state.mode = 'disjoint';
                applyModeConstraints();
                updateModeButtons();
                updatePABUI();
                update();
            });
        }

        function applyModeConstraints() {
            if (state.mode === 'independent') {
                state.pab = state.pa * state.pb;
            } else if (state.mode === 'disjoint') {
                state.pab = 0;
                if (state.pa + state.pb > 1) {
                    const ratio = state.pa / (state.pa + state.pb);
                    state.pa = ratio * 0.99;
                    state.pb = (1 - ratio) * 0.99;
                    elements.rangePA.value = state.pa;
                    elements.rangePB.value = state.pb;
                }
            }
        }

        function updateModeButtons() {
            elements.btnFree.classList.toggle('active', state.mode === 'free');
            elements.btnIndependent.classList.remove('active', 'mode-independent');
            elements.btnDisjoint.classList.remove('active', 'mode-disjoint');

            if (state.mode === 'independent') {
                elements.btnIndependent.classList.add('active', 'mode-independent');
            } else if (state.mode === 'disjoint') {
                elements.btnDisjoint.classList.add('active', 'mode-disjoint');
            }
        }

        // æ›´æ–° P(AB) åŒºåŸŸçš„ UI æ˜¾ç¤º
        function updatePABUI() {
            const pabItem = elements.pabItem;
            const sliderContainer = elements.pabSliderContainer;
            const formulaDisplay = elements.pabFormula;
            const formulaText = elements.formulaText;
            const pabDesc = elements.pabDesc;

            // æ¸…é™¤æ ·å¼
            pabItem.classList.remove('locked', 'locked-disjoint');

            if (state.mode === 'free') {
                // è‡ªç”±æ¨¡å¼ï¼šæ˜¾ç¤ºæ»‘å—
                sliderContainer.style.display = 'block';
                formulaDisplay.style.display = 'none';
                elements.rangePAB.disabled = false;
                pabDesc.textContent = 'A å’Œ B åŒæ—¶å‘ç”Ÿçš„æ¦‚ç‡';
            } else if (state.mode === 'independent') {
                // ç‹¬ç«‹æ¨¡å¼ï¼šæ˜¾ç¤ºå…¬å¼
                sliderContainer.style.display = 'none';
                formulaDisplay.style.display = 'block';
                formulaDisplay.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.04))';
                formulaDisplay.style.borderColor = 'rgba(16, 185, 129, 0.2)';
                formulaText.style.color = '#059669';
                formulaText.innerHTML = `P(A) Ã— P(B) = ${state.pa.toFixed(2)} Ã— ${state.pb.toFixed(2)} = <strong>${state.pab.toFixed(4)}</strong>`;
                pabItem.classList.add('locked');
                pabDesc.textContent = 'ç”±ç‹¬ç«‹æ€§è‡ªåŠ¨è®¡ç®—';
            } else if (state.mode === 'disjoint') {
                // äº’æ–¥æ¨¡å¼ï¼šæ˜¾ç¤ºå…¬å¼
                sliderContainer.style.display = 'none';
                formulaDisplay.style.display = 'block';
                formulaDisplay.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(239, 68, 68, 0.04))';
                formulaDisplay.style.borderColor = 'rgba(239, 68, 68, 0.2)';
                formulaText.style.color = '#dc2626';
                formulaText.innerHTML = `A âˆ© B = âˆ… â†’ P(Aâˆ©B) = <strong>0</strong>`;
                pabItem.classList.add('locked-disjoint');
                pabDesc.textContent = 'Aã€B äº’ä¸ç›¸å®¹ï¼Œäº¤é›†ä¸ºç©º';
            }

            // æ›´æ–°ç‹¬ç«‹æ€§æ ‡è®°ä½ç½®
            updateIndependenceMarker();
        }

        // æ›´æ–°ç‹¬ç«‹æ€§æ ‡è®°åœ¨æ»‘å—ä¸Šçš„ä½ç½® - ä½¿ç”¨ç™¾åˆ†æ¯”å®šä½ï¼ˆä¸æŒ‡ç¤ºå™¨ç›¸åŒï¼‰
        function updateIndependenceMarker() {
            // è¿™ä¸ªå‡½æ•°å·²åºŸå¼ƒï¼Œæ”¹ç”¨ updateDeltaDisplay
        }

        // æ›´æ–°å°ä¸‰è§’é¢œè‰²å’Œåç§»é‡æ˜¾ç¤º
        function updateDeltaDisplay() {
            const indicator = axisElements.indicatorPAB;
            const deltaEl = document.getElementById('independence-delta');
            const independentValue = state.pa * state.pb;
            const delta = state.pab - independentValue;

            // æ›´æ–°å°ä¸‰è§’é¢œè‰²
            if (state.isSnapped || Math.abs(delta) < 0.001) {
                indicator.classList.add('snapped');
            } else {
                indicator.classList.remove('snapped');
            }

            // æ›´æ–°åç§»é‡æ˜¾ç¤º
            deltaEl.classList.remove('positive', 'negative', 'zero', 'show');

            if (Math.abs(delta) < 0.001) {
                // ç®€åŒ–æ˜¾ç¤ºï¼Œåªæ˜¾ç¤º Î” = 0ï¼Œé…åˆç»¿è‰²èƒŒæ™¯è¡¨ç¤ºç‹¬ç«‹
                deltaEl.textContent = 'Î” = 0';
                deltaEl.classList.add('zero', 'show');
            } else if (delta > 0) {
                deltaEl.textContent = `Î” = +${delta.toFixed(3)}`;
                deltaEl.classList.add('positive', 'show');
            } else {
                deltaEl.textContent = `Î” = ${delta.toFixed(3)}`;
                deltaEl.classList.add('negative', 'show');
            }
        }

        function update() {
            // çº¦æŸ P(AB)
            const maxPAB = Math.min(state.pa, state.pb);
            const minPAB = Math.max(0, state.pa + state.pb - 1);

            if (state.mode === 'free') {
                elements.rangePAB.max = maxPAB;
                elements.rangePAB.min = minPAB;
                if (state.pab > maxPAB) state.pab = maxPAB;
                if (state.pab < minPAB) state.pab = minPAB;

                // æ›´æ–°ç‹¬ç«‹æ€§æ ‡è®°ä½ç½®
                updateIndependenceMarker();

                // æ›´æ–° P(AB) åˆ»åº¦è½´
                updatePABAxis();
            }

            // æ›´æ–°æŒ‡ç¤ºå™¨ä½ç½®
            updateValueIndicator(elements.rangePA, axisElements.indicatorPA, state.pa);
            updateValueIndicator(elements.rangePB, axisElements.indicatorPB, state.pb);
            if (state.mode === 'free') {
                updateValueIndicator(elements.rangePAB, axisElements.indicatorPAB, state.pab);
            }

            // æ›´æ–°åç§»é‡æ˜¾ç¤ºï¼ˆæ‰€æœ‰æ¨¡å¼ä¸‹éƒ½æ˜¾ç¤ºï¼‰
            updateDeltaDisplay();

            // æ›´æ–°åœ†ç¯
            const offsetA = circumference * (1 - state.pa);
            const offsetB = circumference * (1 - state.pb);
            const offsetAB = circumference * (1 - state.pab);

            elements.progressA.style.strokeDashoffset = offsetA;
            elements.progressB.style.strokeDashoffset = offsetB;
            elements.progressAB.style.strokeDashoffset = offsetAB;

            // æ›´æ–°æ•°å€¼æ˜¾ç¤º
            elements.valPA.textContent = state.pa.toFixed(2);
            elements.valPB.textContent = state.pb.toFixed(2);
            elements.valPAB.textContent = state.pab.toFixed(2);

            elements.rangePA.value = state.pa;
            elements.rangePB.value = state.pb;
            elements.rangePAB.value = state.pab;

            // åŒæ­¥æ•°å€¼è¾“å…¥æ¡†ï¼ˆä»…å½“è¾“å…¥æ¡†æ²¡æœ‰ç„¦ç‚¹æ—¶æ›´æ–°ï¼‰
            if (document.activeElement !== elements.inputPA) {
                elements.inputPA.value = state.pa.toFixed(4);
            }
            if (document.activeElement !== elements.inputPB) {
                elements.inputPB.value = state.pb.toFixed(4);
            }
            if (document.activeElement !== elements.inputPAB) {
                elements.inputPAB.value = state.pab.toFixed(4);
            }

            // æ›´æ–° P(AB) è¾“å…¥æ¡†çš„èŒƒå›´
            elements.inputPAB.max = maxPAB;
            elements.inputPAB.min = minPAB;

            // ç‹¬ç«‹æ€§æ£€éªŒ
            const product = state.pa * state.pb;
            elements.dispPAB.textContent = state.pab.toFixed(4);
            elements.dispPAPB.textContent = product.toFixed(4);

            // åˆ¤æ–­å…³ç³»
            const isIndep = Math.abs(state.pab - product) < 0.001;
            const statusEl = elements.relationStatus;

            statusEl.className = 'status-badge';
            if (state.pab === 0 && state.pa > 0 && state.pb > 0) {
                statusEl.textContent = 'äº’ä¸ç›¸å®¹';
                statusEl.classList.add('disjoint');
            } else if (isIndep) {
                statusEl.textContent = 'ç›¸äº’ç‹¬ç«‹';
                statusEl.classList.add('independent');
            } else if (state.pab > product) {
                statusEl.textContent = 'æ­£ç›¸å…³';
                statusEl.classList.add('positive');
            } else {
                statusEl.textContent = 'è´Ÿç›¸å…³';
                statusEl.classList.add('negative');
            }

            // è®¡ç®—è¡ç”Ÿå…¬å¼
            const union = state.pa + state.pb - state.pab;
            const diff = state.pa - state.pab;
            const cond = state.pa > 0 ? state.pab / state.pa : 0;

            elements.calcUnion.textContent = union.toFixed(2);
            elements.calcDiff.textContent = diff.toFixed(2);
            elements.calcCond.textContent = cond.toFixed(2);

            // ç»˜åˆ¶éŸ¦æ©å›¾
            drawVenn();
        }

        function drawVenn() {
            const centerY = canvas.height / 2;
            const baseRadius = 100;
            const minRadius = 30;

            // åŠ¨æ€è®¡ç®—åœ†çš„åŠå¾„ï¼ˆé¢ç§¯ä¸æ¦‚ç‡æˆæ­£æ¯”ï¼‰
            let radiusA = baseRadius * Math.sqrt(state.pa / 0.5);
            let radiusB = baseRadius * Math.sqrt(state.pb / 0.5);
            radiusA = Math.max(radiusA, minRadius);
            radiusB = Math.max(radiusB, minRadius);

            // æ ¹æ®äº¤é›†å¤§å°è®¡ç®—ä¸¤åœ†è·ç¦»
            let distance;
            if (state.pab === 0) {
                distance = radiusA + radiusB + 30;
            } else if (state.pab >= Math.min(state.pa, state.pb) - 0.001) {
                distance = Math.abs(radiusA - radiusB) * 0.3;
            } else {
                const overlapRatio = state.pab / Math.min(state.pa, state.pb);
                distance = (radiusA + radiusB) * (1 - overlapRatio * 0.75);
            }

            const centerAx = canvas.width / 2 - distance / 2;
            const centerBx = canvas.width / 2 + distance / 2;

            // ========== ç¬¬ä¸€æ­¥ï¼šåº•å±‚çº¯ç™½ ==========
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ========== ç¬¬äºŒæ­¥ï¼šç”»æ ·æœ¬ç©ºé—´èƒŒæ™¯ï¼ˆæµ…ç°è‰²ï¼‰ ==========
            ctx.fillStyle = '#f1f5f9';
            ctx.fillRect(24, 24, canvas.width - 48, canvas.height - 48);

            // ========== ç¬¬ä¸‰æ­¥ï¼šç”¨ destination-out æ“¦é™¤åœ†çš„åŒºåŸŸ ==========
            ctx.globalCompositeOperation = 'destination-out';

            // æ“¦é™¤åœ† Aï¼ˆéœ²å‡ºåº•éƒ¨ç™½è‰²ï¼‰
            ctx.beginPath();
            ctx.arc(centerAx, centerY, radiusA, 0, Math.PI * 2);
            ctx.fill();

            // æ“¦é™¤åœ† Bï¼ˆéœ²å‡ºåº•éƒ¨ç™½è‰²ï¼‰
            ctx.beginPath();
            ctx.arc(centerBx, centerY, radiusB, 0, Math.PI * 2);
            ctx.fill();

            // ========== ç¬¬å››æ­¥ï¼šæ¢å¤æ­£å¸¸ç»˜åˆ¶æ¨¡å¼ ==========
            ctx.globalCompositeOperation = 'source-over';

            // ========== ç¬¬äº”æ­¥ï¼šç»˜åˆ¶æ ·æœ¬ç©ºé—´è™šçº¿è¾¹æ¡† ==========
            ctx.strokeStyle = '#cbd5e1';
            ctx.lineWidth = 1.5;
            ctx.setLineDash([6, 4]);
            ctx.strokeRect(24, 24, canvas.width - 48, canvas.height - 48);
            ctx.setLineDash([]);

            // ========== ç¬¬å…­æ­¥ï¼šç»˜åˆ¶å½©è‰²åœ† A ==========
            ctx.beginPath();
            ctx.arc(centerAx, centerY, radiusA, 0, Math.PI * 2);
            // æ·»åŠ ç¾½åŒ–æ•ˆæœï¼ˆå¤–å‘å…‰é˜´å½±ï¼‰
            ctx.shadowColor = 'rgba(249, 115, 22, 0.4)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            // ä½¿ç”¨æ›´æŸ”å’Œã€é«˜çº§çš„æ©™è‰²
            ctx.fillStyle = 'rgba(251, 146, 60, 0.55)';
            ctx.fill();
            // æ¸…é™¤é˜´å½±ä»¥ç»˜åˆ¶æè¾¹
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            // ç»†è…»çš„æ·±è‰²æè¾¹
            ctx.strokeStyle = 'rgba(234, 88, 12, 0.5)';
            ctx.lineWidth = 2;
            ctx.stroke();

            // ========== ç¬¬ä¸ƒæ­¥ï¼šç»˜åˆ¶å½©è‰²åœ† B ==========
            ctx.beginPath();
            ctx.arc(centerBx, centerY, radiusB, 0, Math.PI * 2);
            // æ·»åŠ ç¾½åŒ–æ•ˆæœï¼ˆå¤–å‘å…‰é˜´å½±ï¼‰
            ctx.shadowColor = 'rgba(59, 130, 246, 0.4)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            // ä½¿ç”¨æ›´æŸ”å’Œã€é«˜çº§çš„è“è‰²
            ctx.fillStyle = 'rgba(96, 165, 250, 0.55)';
            ctx.fill();
            // æ¸…é™¤é˜´å½±ä»¥ç»˜åˆ¶æè¾¹
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            // ç»†è…»çš„æ·±è‰²æè¾¹
            ctx.strokeStyle = 'rgba(37, 99, 235, 0.5)';
            ctx.lineWidth = 2;
            ctx.stroke();

            // ========== ç¬¬å…«æ­¥ï¼šé«˜äº®äº¤é›†åŒºåŸŸ ==========
            if (state.pab > 0.001) {
                ctx.save();
                // è£å‰ªå‡ºäº¤é›†åŒºåŸŸ
                ctx.beginPath();
                ctx.arc(centerAx, centerY, radiusA, 0, Math.PI * 2);
                ctx.clip();

                ctx.beginPath();
                ctx.arc(centerBx, centerY, radiusB, 0, Math.PI * 2);
                // ä½¿ç”¨ä¼˜é›…çš„ç´«è‰²é«˜äº®äº¤é›†
                ctx.fillStyle = 'rgba(139, 92, 246, 0.4)';
                ctx.fill();
                ctx.restore();
            }

            // ========== ç¬¬ä¹æ­¥ï¼šç»˜åˆ¶æ ‡ç­¾ ==========
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // æ ·æœ¬ç©ºé—´æ ‡ç­¾ - æ›´ä½è°ƒä¼˜é›…
            ctx.fillStyle = '#94a3b8';
            ctx.font = '500 12px Inter';
            ctx.textAlign = 'left';
            ctx.fillText('Î©', 32, 42);

            // äº‹ä»¶ A æ ‡ç­¾ - ä½¿ç”¨æ·±æ©™è‰²ï¼Œæ›´åŠ é†’ç›®
            ctx.textAlign = 'center';
            ctx.fillStyle = '#c2410c';
            ctx.font = '700 32px Inter';
            ctx.fillText('A', centerAx, centerY);

            // äº‹ä»¶ B æ ‡ç­¾ - ä½¿ç”¨æ·±è“è‰²ï¼Œæ›´åŠ é†’ç›®
            ctx.fillStyle = '#1d4ed8';
            ctx.font = '700 32px Inter';
            ctx.fillText('B', centerBx, centerY);

            // äº¤é›†æ ‡ç­¾ - ä¼˜é›…çš„ç´«è‰²
            if (state.pab > 0.03 && distance < radiusA + radiusB - 20) {
                ctx.fillStyle = '#7c3aed';
                ctx.font = '600 13px Inter';
                ctx.fillText('Aâˆ©B', (centerAx + centerBx) / 2, centerY + 48);
            }

            // æ¦‚ç‡æ•°å€¼ï¼ˆåœ†çš„ä¸‹æ–¹ï¼‰- æ›´ç²¾è‡´çš„æ ·å¼
            ctx.font = '500 11px "JetBrains Mono"';
            ctx.fillStyle = '#64748b';
            ctx.fillText(`P(A)=${state.pa.toFixed(2)}`, centerAx, centerY + radiusA + 22);
            ctx.fillText(`P(B)=${state.pb.toFixed(2)}`, centerBx, centerY + radiusB + 22);

            // P(AB) æ•°å€¼ - ç´«è‰²é«˜äº®
            if (state.pab > 0.01) {
                ctx.fillStyle = '#7c3aed';
                ctx.font = '500 11px "JetBrains Mono"';
                ctx.fillText(`P(Aâˆ©B)=${state.pab.toFixed(2)}`, (centerAx + centerBx) / 2, centerY + 68);
            }

            // "éƒ½ä¸å‘ç”Ÿ"æ¦‚ç‡ - å³ä¸‹è§’ä½è°ƒæ˜¾ç¤º
            const pNeither = 1 - (state.pa + state.pb - state.pab);
            if (pNeither > 0.01) {
                ctx.fillStyle = '#94a3b8';
                ctx.font = '400 10px "JetBrains Mono"';
                ctx.textAlign = 'right';
                ctx.fillText(`P(Î©âˆ–(AâˆªB))=${pNeither.toFixed(2)}`, canvas.width - 32, canvas.height - 32);
            }
        }

        // åˆ›å»ºå†²çªæç¤ºå…ƒç´ 
        function createConflictHint() {
            let hint = document.getElementById('conflict-hint');
            if (!hint) {
                hint = document.createElement('div');
                hint.id = 'conflict-hint';
                hint.className = 'conflict-hint';
                const sliderContainer = document.getElementById('pab-slider-container');
                sliderContainer.style.position = 'relative';
                sliderContainer.appendChild(hint);
            }
            return hint;
        }

        // æ˜¾ç¤º/éšè—å†²çªæç¤º
        function showConflictHint(message) {
            const hint = createConflictHint();
            hint.textContent = message;
            hint.classList.add('show');

            // 3ç§’åè‡ªåŠ¨éšè—
            clearTimeout(window.conflictHintTimeout);
            window.conflictHintTimeout = setTimeout(() => {
                hint.classList.remove('show');
            }, 3000);
        }

        function hideConflictHint() {
            const hint = document.getElementById('conflict-hint');
            if (hint) {
                hint.classList.remove('show');
            }
        }

        // æ£€æŸ¥å¹¶æ˜¾ç¤ºå†²çªæç¤º
        function checkAndShowConflict(attemptedValue, actualValue, minPAB, maxPAB) {
            if (attemptedValue < minPAB) {
                showConflictHint(`å…¨æ¦‚ç‡é™åˆ¶ï¼šP(AB) â‰¥ ${minPAB.toFixed(4)}`);
            } else if (attemptedValue > maxPAB) {
                showConflictHint(`ä¸Šç•Œé™åˆ¶ï¼šP(AB) â‰¤ ${maxPAB.toFixed(4)}`);
            } else {
                hideConflictHint();
            }
        }

        init();

        // Render Math
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ]
            });
        });
    </script>
</body>

</html>